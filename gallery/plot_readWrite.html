

<!DOCTYPE html>
<html class="writer-html5" lang="fr" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Premières manipulations de données spatiales &mdash; Documentation Mémocarto </title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery-dataframe.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery-rendered-html.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" />
    <link rel="next" title="Exploitation des flux WFS et WMS" href="plot_WMS_WFS.html" />
    <link rel="prev" title="Délimitation de tâches bâties" href="plot_delimitationOfBuildingAreas.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Mémocarto
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../pourquoi.html">Pourquoi faire des cartes ?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../acteurs.html">Tour d'horizon des acteurs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../objgeo.html">Les objets géographiques</a></li>
</ul>
<p class="caption"><span class="caption-text">Stockage des données spatiales</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../projections.html">Les projections !</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fichiers_geo.html">Les fichiers cartographiques</a></li>
<li class="toctree-l1"><a class="reference internal" href="../postgis.html">Les bases de données spatiales Postgis</a></li>
</ul>
<p class="caption"><span class="caption-text">Manipulation des données spatiales</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../qgis.html"> Qgis, la boite à outils du cartographe</a></li>
<li class="toctree-l1"><a class="reference internal" href="../operations.html"> Opérations spatiales</a></li>
<li class="toctree-l1"><a class="reference internal" href="../postgis.html"> Requêtes spatiales sous SQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../geocodage.html"> La localisation des données géos : quels outils de géocodage ?</a></li>
</ul>
<p class="caption"><span class="caption-text">Diffusion</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../semio.html">La sémiologie : une grammaire spatiale</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts.html">Heurs et malheurs de la spatialisation des données statistiques</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cartes_stat.html">Une première carte statique (et discrétisation des aplats de couleurs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../geoserver.html">Geoserver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../leaflet.html">Leaflet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../articulation.html">Comment tout cela s'articule-t-il?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../implementation.html">Un exemple d'implémentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cartes_dynamiques.html">D'autres exemples de cartes dynamiques</a></li>
</ul>
<p class="caption"><span class="caption-text">On s'exerce !</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../geopandas.html">Mini présentation de GeoPandas</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Galerie d'exemples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="discretisation.html">Retour sur la discrétisation des variables quantitatives</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_delimitationOfBuildingAreas.html">Délimitation de tâches bâties</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Premières manipulations de données spatiales</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#ouverture-des-donnees">Ouverture des données</a></li>
<li class="toctree-l3"><a class="reference internal" href="#jointure-des-donnees">Jointure des données</a></li>
<li class="toctree-l3"><a class="reference internal" href="#aggregation-des-donnees-pour-produire-des-donnees-departementales-et-regionales">Aggregation des données pour produire des données départementales et régionales</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#carte-au-niveau-departemental">Carte au niveau départemental</a></li>
<li class="toctree-l4"><a class="reference internal" href="#carte-au-niveau-regional">Carte au niveau régional</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="plot_WMS_WFS.html">Exploitation des flux WFS et WMS</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../postgisPy.html">Postgis sous Python</a></li>
</ul>
<p class="caption"><span class="caption-text">Contributeurs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contributors.html"> Contributeurs</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Mémocarto</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Examples Gallery</a> &raquo;</li>
        
      <li>Premières manipulations de données spatiales</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/gallery/plot_readWrite.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-gallery-plot-readwrite-py"><span class="std std-ref">here</span></a>
to download the full example code</p>
</div>
<div class="sphx-glr-example-title section" id="premieres-manipulations-de-donnees-spatiales">
<span id="sphx-glr-gallery-plot-readwrite-py"></span><h1>Premières manipulations de données spatiales<a class="headerlink" href="#premieres-manipulations-de-donnees-spatiales" title="Lien permanent vers ce titre">¶</a></h1>
<p>Dans ce notebook, nous allons apprendre à lire, écrire, merger et aggréger des données spatiales.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># sphinx_gallery_thumbnail_number = 1</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">config</span>
</pre></div>
</div>
<div class="section" id="ouverture-des-donnees">
<h2>Ouverture des données<a class="headerlink" href="#ouverture-des-donnees" title="Lien permanent vers ce titre">¶</a></h2>
<p>Les données attributaires proviennent du recensement de la population de 2017. La base commune contient la population communale, PTOT (et par arrondissement pour Paris, Lyon et Marseille). Attention, les données sont en géographie 2019.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">population</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;URL_DATA_COMMUNES&quot;</span><span class="p">),</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;DEPCOM&#39;</span><span class="p">:</span><span class="nb">str</span><span class="p">})</span>
<span class="n">population</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>DEPCOM</th>
      <th>COM</th>
      <th>PMUN</th>
      <th>PCAP</th>
      <th>PTOT</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>01001</td>
      <td>L' Abergement-Clémenciat</td>
      <td>776</td>
      <td>18</td>
      <td>794</td>
    </tr>
    <tr>
      <th>1</th>
      <td>01002</td>
      <td>L' Abergement-de-Varey</td>
      <td>248</td>
      <td>1</td>
      <td>249</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<br />
<br /><p>On ouvre le fond des communes et on lui rajoute les arrondissements.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">commune</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;URL_GEOJSON_COMMUNES&quot;</span><span class="p">))</span>
<span class="n">armf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;URL_GEOJSON_ARMF&quot;</span><span class="p">))</span>
<span class="n">armf</span><span class="p">[</span><span class="s1">&#39;dep&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">armf</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="c1"># il manque le numèro de département dans le fond armf</span>
<span class="n">commune</span> <span class="o">=</span> <span class="n">commune</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">armf</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="jointure-des-donnees">
<h2>Jointure des données<a class="headerlink" href="#jointure-des-donnees" title="Lien permanent vers ce titre">¶</a></h2>
<p>La jointure entre les deux tables s’opère simplement à l’aide de la fonction <code class="docutils literal notranslate"><span class="pre">gpd.merge()</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pop_com</span> <span class="o">=</span> <span class="n">commune</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">population</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;code&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;DEPCOM&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>On peut afficher une carte de densité en quelques lignes de code en recourant à la fonction <code class="docutils literal notranslate"><span class="pre">gpd.plot()</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pop_com</span><span class="p">[</span><span class="s1">&#39;densite&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pop_com</span><span class="o">.</span><span class="n">PTOT</span> <span class="o">/</span> <span class="n">pop_com</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">area</span> <span class="o">*</span> <span class="mi">1000000</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">pop_com</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;densite&#39;</span><span class="p">,</span><span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scheme</span><span class="o">=</span><span class="s1">&#39;quantiles&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;OrRd&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
<img alt="plot readWrite" class="sphx-glr-single-img" src="../_images/sphx_glr_plot_readWrite_001.png" />
</div>
<div class="section" id="aggregation-des-donnees-pour-produire-des-donnees-departementales-et-regionales">
<h2>Aggregation des données pour produire des données départementales et régionales<a class="headerlink" href="#aggregation-des-donnees-pour-produire-des-donnees-departementales-et-regionales" title="Lien permanent vers ce titre">¶</a></h2>
<p>L’aggrégation des données spatiales s’effectue à l’aide de la fonction <code class="docutils literal notranslate"><span class="pre">gpd.dissolve()</span></code> qui repose sur la méthode <strong>groupby</strong> de pandas. <strong>aggfunc</strong> définit la fonction a appliqué aux données attributaires.</p>
<div class="section" id="carte-au-niveau-departemental">
<h3>Carte au niveau départemental<a class="headerlink" href="#carte-au-niveau-departemental" title="Lien permanent vers ce titre">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pop_dep</span> <span class="o">=</span> <span class="n">pop_com</span><span class="o">.</span><span class="n">dissolve</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;dep&#39;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">pop_dep</span><span class="p">[</span><span class="s1">&#39;densite&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pop_dep</span><span class="o">.</span><span class="n">PTOT</span> <span class="o">/</span> <span class="n">pop_dep</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">area</span> <span class="o">*</span> <span class="mi">1000000</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">pop_dep</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;densite&#39;</span><span class="p">,</span><span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scheme</span><span class="o">=</span><span class="s1">&#39;quantiles&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;OrRd&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="plot readWrite" class="sphx-glr-single-img" src="../_images/sphx_glr_plot_readWrite_002.png" />
</div>
<div class="section" id="carte-au-niveau-regional">
<h3>Carte au niveau régional<a class="headerlink" href="#carte-au-niveau-regional" title="Lien permanent vers ce titre">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pop_reg</span> <span class="o">=</span> <span class="n">pop_com</span><span class="o">.</span><span class="n">dissolve</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;reg&#39;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">pop_reg</span><span class="p">[</span><span class="s1">&#39;densite&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pop_reg</span><span class="o">.</span><span class="n">PTOT</span> <span class="o">/</span> <span class="n">pop_reg</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">area</span> <span class="o">*</span> <span class="mi">1000000</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">pop_reg</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;densite&#39;</span><span class="p">,</span><span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scheme</span><span class="o">=</span><span class="s1">&#39;quantiles&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;OrRd&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="plot readWrite" class="sphx-glr-single-img" src="../_images/sphx_glr_plot_readWrite_003.png" />
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  38.887 seconds)</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-gallery-plot-readwrite-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/ea86546be10ba80d562c0614966330c6/plot_readWrite.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_readWrite.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/9dc9920f03a1b52a928c11f6ddc57c31/plot_readWrite.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_readWrite.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="plot_WMS_WFS.html" class="btn btn-neutral float-right" title="Exploitation des flux WFS et WMS" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="plot_delimitationOfBuildingAreas.html" class="btn btn-neutral float-left" title="Délimitation de tâches bâties" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, multiples auteurs.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>